<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Qian Yi — Notes & Research</title>
<!-- marked.js：渲染 Markdown -->
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<style>
html, body {
  height: 100%;
  margin: 0;
  font-family: "Noto Sans SC", sans-serif;
  background: url('assets/bg-stars.jpg') no-repeat center center fixed;
  background-size: cover;
  color: #e6eef8;
}

/* 布局 */
main {
  display: flex;
  flex-direction: row;
  height: 100vh;
}

aside {
  width: 220px;
  background: rgba(20, 24, 38, 0.8);
  padding: 1rem;
  box-shadow: 2px 0 8px rgba(0,0,0,0.3);
}

aside h1 {
  font-size: 1.2rem;
  margin-bottom: 1rem;
  color: #fff;
}

nav a {
  display: block;
  color: #c5d0e6;
  text-decoration: none;
  padding: 0.4rem 0;
  border-left: 3px solid transparent;
}
nav a:hover {
  color: #fff;
  border-left: 3px solid #5aa9e6;
}

/* 主区 */
section[data-view] {
  flex: 1;
  overflow-y: auto;
  padding: 2rem;
  backdrop-filter: blur(10px);
}

/* 卡片风格 */
.card {
  background: rgba(255,255,255,0.08);
  padding: 1.2rem;
  border-radius: 1rem;
  margin-bottom: 1rem;
  box-shadow: 0 0 6px rgba(0,0,0,0.3);
}

.card h2 {
  margin: 0;
  color: #fff;
  cursor: pointer;
}

.card p {
  margin: 0.3rem 0 0.5rem 0;
  color: #cfd8e6;
}

.meta {
  font-size: 0.8rem;
  color: #9fb3d0;
}

/* Markdown 渲染样式 */
#post-detail h1, #post-detail h2, #post-detail h3 {
  color: #fff;
}
#post-detail p {
  color: #cfd8e6;
  line-height: 1.6;
}
#post-detail pre {
  background: rgba(255,255,255,0.1);
  padding: 0.5rem;
  border-radius: 0.5rem;
  overflow-x: auto;
}

/* 隐藏与切换 */
[hidden] { display: none; }
</style>
</head>

<body>
<main>
  <aside>
    <h1>Qian Yi</h1>
    <nav>
      <a href="#" onclick="showView('home')">首页</a>
      <a href="#" onclick="showView('resources')">资源</a>
      <a href="#" onclick="showView('about')">关于</a>
    </nav>
  </aside>

  <section id="home" class="card" data-view>
    <h2>最新笔记</h2>
    <div id="post-list"></div>
  </section>

  <section id="post-detail" class="card" data-view hidden></section>

  <section id="resources" class="card" data-view hidden>
    <h2>资源列表</h2>
    <div id="resource-list"></div>
  </section>

  <section id="about" class="card" data-view hidden>
    <h2>关于本站</h2>
    <p>这里记录了我的研究笔记、思考与项目进展，涉及纺织品色彩感知、跨模态检索与AI+设计方向。</p>
  </section>
</main>

<script>
const data = { posts: [], resources: [] };

// 切换视图
function showView(viewId) {
  document.querySelectorAll('[data-view]').forEach(sec => sec.hidden = true);
  document.getElementById(viewId).hidden = false;
  if (viewId === 'home') renderPosts();
  if (viewId === 'resources') renderResources();
}

// 加载文章索引
async function loadPosts() {
  try {
    const res = await fetch('posts/index.json');
    data.posts = await res.json();
    renderPosts();
  } catch (e) {
    document.getElementById('post-list').innerHTML = '<p>无法加载文章索引。</p>';
  }
}

// 渲染文章列表
function renderPosts() {
  const list = document.getElementById('post-list');
  list.innerHTML = '';
  data.posts.sort((a,b) => new Date(b.date) - new Date(a.date));
  data.posts.forEach(post => {
    const div = document.createElement('div');
    div.className = 'card';
    div.innerHTML = `
      <h2 onclick="showPostDetail('${post.url}')">${post.title}</h2>
      <p>${post.summary}</p>
      <div class="meta">${post.date}｜${post.tags.join(' / ')}</div>
    `;
    list.appendChild(div);
  });
}

// 加载 Markdown 并渲染
async function showPostDetail(url) {
  const sec = document.getElementById('post-detail');
  document.querySelectorAll('[data-view]').forEach(s => s.hidden = true);
  sec.hidden = false;
  try {
    const res = await fetch(url);
    const text = await res.text();
    sec.innerHTML = marked.parse(text) + '<p><a href="#" onclick="showView(\'home\')">← 返回首页</a></p>';
  } catch {
    sec.innerHTML = '<p>无法加载文章内容。</p>';
  }
}

// 加载资源列表
async function loadResources() {
  try {
    const res = await fetch('resources/index.json');
    data.resources = await res.json();
  } catch {
    data.resources = [];
  }
}

// 渲染资源
function renderResources() {
  const list = document.getElementById('resource-list');
  list.innerHTML = '';
  if (data.resources.length === 0) {
    list.innerHTML = '<p>暂无资源。</p>';
    return;
  }
  data.resources.forEach(r => {
    const div = document.createElement('div');
    div.className = 'card';
    div.innerHTML = `<strong>${r.type || '资源'}</strong>：<a href="${r.url}" target="_blank">${r.title}</a>`;
    list.appendChild(div);
  });
}

// 初始化
loadPosts();
loadResources();
</script>
</body>
</html>
